{% extends "layouts/base.html" %}
{% block title %}Pricing Plans{% endblock %}

{% block content %}
<div x-data="{ activeTab: 'subscription' }" class="bg-white py-24 sm:py-32">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <!-- Header -->
        <div class="mx-auto max-w-4xl text-center">
            <h2 class="text-base font-semibold leading-7 text-indigo-600">Pricing</h2>
            <p class="mt-2 text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl">
                Flexible plans for everyone
            </p>
        </div>
        <p class="mx-auto mt-6 max-w-2xl text-center text-lg leading-8 text-slate-600">
            Start free with {{ settings.FREE_SIGNUP_COINS }} {{ settings.CREDIT_UNIT_NAME_PLURAL }}. Choose a subscription for the best value, or top up with a one-time pack.
        </p>

        <!-- Flash Messages -->
        <div class="mt-8 max-w-2xl mx-auto">
             {% include 'partials/flash.html' %}
        </div>
       
        <!-- Tab Controls -->
        <div class="mt-16 flex justify-center">
            <div role="tablist" class="grid grid-cols-2 gap-x-1 rounded-full p-1 text-center text-xs font-semibold leading-5 ring-1 ring-inset ring-slate-200">
                <button @click="activeTab = 'subscription'" :class="activeTab === 'subscription' ? 'bg-indigo-600 text-white' : 'text-slate-500 hover:bg-slate-100'" class="rounded-full px-4 py-2 transition-colors duration-200 ease-in-out focus:outline-none">Monthly Plans</button>
                <button @click="activeTab = 'oneTime'" :class="activeTab === 'oneTime' ? 'bg-indigo-600 text-white' : 'text-slate-500 hover:bg-slate-100'" class="rounded-full px-4 py-2 transition-colors duration-200 ease-in-out focus:outline-none">One-Time Packs</button>
            </div>
        </div>

        <!-- Subscription Plans Pane -->
        <div x-show="activeTab === 'subscription'" class="isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
            {% if subscription_plans %}
                {% for plan in subscription_plans %}
                <div class="rounded-3xl p-8 ring-1 ring-slate-200 xl:p-10 hover:ring-2 hover:ring-indigo-600 transition duration-200">
                    <h3 class="text-lg font-semibold leading-8 text-slate-900">{{ plan.name }}</h3>
                    <p class="mt-4 text-sm leading-6 text-slate-600">{{ plan.description }}</p>
                    <p class="mt-6 flex items-baseline gap-x-1">
                        <span class="text-4xl font-bold tracking-tight text-slate-900">${{ "%.2f"|format(plan.price) }}</span>
                        <span class="text-sm font-semibold leading-6 text-slate-600">/month</span>
                    </p>
                     <p class="mt-4 text-base font-semibold text-indigo-600">
                        <i class="fa-solid fa-coins text-amber-500 mr-1"></i> {{ plan.coins }} {{ settings.CREDIT_UNIT_NAME_PLURAL }} / month
                    </p>
                    {% if current_user and current_user.subscription_status == 'active' %}
                        <button class="mt-6 block w-full rounded-md bg-slate-100 px-3 py-2 text-center text-sm font-semibold leading-6 text-slate-500" disabled>Already Subscribed</button>
                    {% else %}
                        <form action="/create-checkout-session" method="POST" class="w-full">
                            <input type="hidden" name="price_id" value="{{ plan.price_id }}">
                            <input type="hidden" name="mode" value="subscription">
                            <button type="submit" class="mt-6 block w-full rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500">Subscribe</button>
                        </form>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p class="text-center text-slate-600 col-span-full">Subscription plans are currently unavailable.</p>
            {% endif %}
        </div>

        <!-- One-Time Packs Pane -->
        <div x-show="activeTab === 'oneTime'" style="display: none;" class="isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
            {% if one_time_packs %}
                {% for pack in one_time_packs %}
                <div class="rounded-3xl p-8 ring-1 ring-slate-200 xl:p-10 hover:ring-2 hover:ring-indigo-600 transition duration-200">
                    <h3 class="text-lg font-semibold leading-8 text-slate-900">{{ pack.name }}</h3>
                    <p class="mt-4 text-sm leading-6 text-slate-600">{{ pack.description }}</p>
                    <p class="mt-6 flex items-baseline gap-x-1">
                        <span class="text-4xl font-bold tracking-tight text-slate-900">${{ "%.2f"|format(pack.price) }}</span>
                    </p>
                    <p class="mt-4 text-base font-semibold text-indigo-600">
                        <i class="fa-solid fa-coins text-amber-500 mr-1"></i> {{ pack.coins }} {{ settings.CREDIT_UNIT_NAME_PLURAL }}
                    </p>
                    <form action="/create-checkout-session" method="POST" class="w-full">
                        <input type="hidden" name="price_id" value="{{ pack.price_id }}">
                        <input type="hidden" name="mode" value="payment">
                        <button type="submit" class="mt-6 block w-full rounded-md bg-indigo-50 px-3 py-2 text-center text-sm font-semibold leading-6 text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:ring-indigo-300">Buy Now</button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-center text-slate-600 col-span-full">One-time packs are currently unavailable.</p>
            {% endif %}
        </div>
        
    </div>
</div>
{% endblock %}