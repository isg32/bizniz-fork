{% extends "layouts/base.html" %} {% block title %}Pricing Plans{% endblock %}
{% block content %}
<div
    x-data="{ activeTab: 'subscription' }"
    class="py-24 sm:py-32"
    style="background-color: var(--bg-color)"
>
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <!-- Header -->
        <div class="mx-auto max-w-4xl text-center">
            <h2 class="text-base font-semibold leading-7 theme-text-secondary">
                Pricing
            </h2>
            <p
                class="mt-2 text-4xl font-bold tracking-tight sm:text-5xl"
                style="color: var(--text-color)"
            >
                Flexible plans for everyone
            </p>
        </div>
        <p
            class="mx-auto mt-6 max-w-2xl text-center text-lg leading-8 theme-text-secondary"
        >
            Start free with {{ settings.FREE_SIGNUP_COINS }} {{
            settings.CREDIT_UNIT_NAME_PLURAL }}. Choose a subscription for the
            best value, or top up with a Booster Pack.
        </p>

        <!-- Flash Messages -->
        <div class="mt-8 max-w-2xl mx-auto">
            {% include 'partials/flash.html' %}
        </div>

        <!-- Tab Controls -->
        <div class="mt-16 flex justify-center">
            <div
                role="tablist"
                class="grid grid-cols-2 gap-x-1 rounded-full p-1 text-center text-xs font-semibold leading-5 ring-1 ring-inset theme-border"
                style="background-color: var(--bg-surface)"
            >
                <button
                    @click="activeTab = 'subscription'"
                    :class="activeTab === 'subscription' ? 'bg-indigo-600 text-white' : 'theme-text-secondary hover:bg-slate-700/50'"
                    class="rounded-full px-4 py-2 transition-colors duration-200 ease-in-out focus:outline-none"
                >
                    Monthly Plans
                </button>
                <button
                    @click="activeTab = 'oneTime'"
                    :class="activeTab === 'oneTime' ? 'bg-indigo-600 text-white' : 'theme-text-secondary hover:bg-slate-700/50'"
                    class="rounded-full px-4 py-2 transition-colors duration-200 ease-in-out focus:outline-none"
                >
                    Booster Packs
                </button>
            </div>
        </div>

        <!-- Subscription Plans Pane -->
        <div
            x-show="activeTab === 'subscription'"
            class="isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-3"
        >
            {% if subscription_plans %} {% for plan in subscription_plans %}
            <div
                class="rounded-3xl p-8 ring-1 xl:p-10 hover:ring-2 hover:ring-indigo-600 transition duration-200 theme-surface theme-border"
            >
                <h3
                    class="text-lg font-semibold leading-8"
                    style="color: var(--text-color)"
                >
                    {{ plan.name }}
                </h3>
                <p class="mt-4 text-sm leading-6 theme-text-secondary">
                    {{ plan.description }}
                </p>
                <p class="mt-6 flex items-baseline gap-x-1">
                    <span
                        class="text-4xl font-bold tracking-tight"
                        style="color: var(--text-color)"
                        >${{ "%.2f"|format(plan.price) }}</span
                    >
                    <span
                        class="text-sm font-semibold leading-6"
                        style="color: var(--text-secondary)"
                        >/month</span
                    >
                </p>
                <p
                    class="mt-4 text-base font-semibold"
                    style="color: var(--accent-color)"
                >
                    <i class="fa-solid fa-coins text-amber-500 mr-1"></i> {{
                    plan.coins }} {{ settings.CREDIT_UNIT_NAME_PLURAL }} / month
                </p>
                {% if current_user and current_user.subscription_status ==
                'active' %}
                <button
                    class="mt-6 block w-full rounded-md px-3 py-2 text-center text-sm font-semibold leading-6 theme-text-secondary"
                    style="background-color: var(--border-color)"
                    disabled
                >
                    Already Subscribed
                </button>
                {% else %}
                <form
                    action="/create-checkout-session"
                    method="POST"
                    class="w-full"
                >
                    <input
                        type="hidden"
                        name="price_id"
                        value="{{ plan.price_id }}"
                    />
                    <input type="hidden" name="mode" value="subscription" />
                    <button
                        type="submit"
                        class="mt-6 block w-full rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500"
                    >
                        Subscribe
                    </button>
                </form>
                {% endif %}
            </div>
            {% endfor %} {% else %}
            <p class="text-center theme-text-secondary col-span-full">
                Subscription plans are currently unavailable.
            </p>
            {% endif %}
        </div>

        <!-- Topupps Pane -->
        <div
            x-show="activeTab === 'oneTime'"
            style="display: none"
            class="isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-8 lg:mx-0 lg:max-w-none lg:grid-cols-3"
        >
            {% if one_time_packs %} {% for pack in one_time_packs %}
            <div
                class="rounded-3xl p-8 ring-1 xl:p-10 hover:ring-2 hover:ring-indigo-600 transition duration-200 theme-surface theme-border"
            >
                <h3
                    class="text-lg font-semibold leading-8"
                    style="color: var(--text-color)"
                >
                    {{ pack.name }}
                </h3>
                <p class="mt-4 text-sm leading-6 theme-text-secondary">
                    {{ pack.description }}
                </p>
                <p class="mt-6 flex items-baseline gap-x-1">
                    <span
                        class="text-4xl font-bold tracking-tight"
                        style="color: var(--text-color)"
                        >${{ "%.2f"|format(pack.price) }}</span
                    >
                </p>
                <p
                    class="mt-4 text-base font-semibold"
                    style="color: var(--accent-color)"
                >
                    <i class="fa-solid fa-coins text-amber-500 mr-1"></i> {{
                    pack.coins }} {{ settings.CREDIT_UNIT_NAME_PLURAL }}
                </p>
                {% if current_user and current_user.subscription_status ==
                'active' %}
                <form
                    action="/create-checkout-session"
                    method="POST"
                    class="w-full"
                >
                    <input
                        type="hidden"
                        name="price_id"
                        value="{{ pack.price_id }}"
                    />
                    <input type="hidden" name="mode" value="payment" />
                    <button
                        type="submit"
                        class="mt-6 block w-full rounded-md bg-indigo-50 px-3 py-2 text-center text-sm font-semibold leading-6 text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:ring-indigo-300"
                    >
                        Buy Now
                    </button>
                </form>
                {% else %}
                <button
                    disabled
                    class="mt-6 block w-full rounded-md px-3 py-2 text-center text-sm font-semibold leading-6 theme-text-secondary"
                    style="background-color: var(--border-color)"
                >
                    Booster Packs (requires an active subscription)
                </button>
                {% endif %}
            </div>
            {% endfor %} {% else %}
            <p class="text-center theme-text-secondary col-span-full">
                Booster Packs are currently unavailable.
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
