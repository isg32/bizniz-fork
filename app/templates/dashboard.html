{% extends "layouts/base.html" %} {% block title %}Your Dashboard{% endblock %}
{% block content %}
<div style="background-color: var(--bg-color)">
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="pb-8 border-b theme-border">
            <h1
                class="text-3xl font-bold tracking-tight"
                style="color: var(--text-color)"
            >
                Dashboard
            </h1>
            <p class="mt-1 text-lg theme-text-secondary">
                Welcome back, {{ current_user.name }}!
            </p>
        </div>

        <div class="mt-8">{% include 'partials/flash.html' %}</div>

        <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-10">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-10">
                <!-- Account Overview -->
                <div>
                    <h2
                        class="text-lg font-medium mb-4"
                        style="color: var(--text-color)"
                    >
                        Account Overview
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Balance Card -->
                        <div
                            class="p-6 rounded-lg theme-shadow theme-border flex flex-col"
                            style="background: var(--bg-hero-color)"
                        >
                            <div class="flex items-start justify-between">
                                <div>
                                    <p
                                        class="text-sm font-medium theme-text-secondary"
                                    >
                                        {{ settings.CREDIT_UNIT_NAME_PLURAL }}
                                        Balance
                                    </p>
                                    <p
                                        class="text-3xl font-bold mt-1"
                                        style="color: var(--accent-color)"
                                    >
                                        {{
                                        "%.0f"|format(current_user.coins|float)
                                        }}
                                    </p>
                                    {% if not current_user or
                                    current_user.subscription_status != 'active'
                                    %}
                                    <p class="mt-2 text-sm text-amber-700">
                                        Note: Your credits will only be
                                        accessible when your subscription is
                                        active.
                                    </p>
                                    {% endif %}
                                </div>
                                <div class="p-2 bg-amber-100 rounded-md">
                                    <i
                                        class="fa-solid fa-coins fa-lg text-amber-500"
                                    ></i>
                                </div>
                            </div>
                            <div class="mt-auto pt-4">
                                <a
                                    href="/pricing"
                                    class="w-full text-center rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"
                                    >Get More</a
                                >
                            </div>
                        </div>
                        <!-- Subscription Card -->
                        <div
                            class="p-6 rounded-lg theme-shadow theme-border flex flex-col"
                            style="background: var(--bg-hero-color)"
                        >
                            <div class="flex items-start justify-between">
                                <div>
                                    <p
                                        class="text-sm font-medium theme-text-secondary"
                                    >
                                        Subscription Plan
                                    </p>
                                    <p
                                        class="text-3xl font-bold mt-1"
                                        style="color: var(--text-color)"
                                    >
                                        {{ current_user.active_plan_name or
                                        'None' }}
                                    </p>
                                </div>
                                <div class="p-2 bg-slate-100 rounded-md">
                                    <i
                                        class="fa-solid fa-credit-card fa-lg text-slate-500"
                                    ></i>
                                </div>
                            </div>
                            <p class="mt-2 text-sm theme-text-secondary">
                                Status:
                                <span
                                    class="font-semibold"
                                    style="color: var(--text-color)"
                                    >{{
                                    current_user.subscription_status|capitalize
                                    }}</span
                                >
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Transaction History -->
                <div>
                    <h2
                        class="text-lg font-medium mb-4"
                        style="color: var(--text-color)"
                    >
                        Transaction History
                    </h2>
                    <!-- MODIFICATION START: Added a container div for scrolling -->
                    <div
                        class="rounded-lg theme-shadow theme-border max-h-[32rem] overflow-y-auto"
                    >
                        <!-- MODIFICATION END -->
                        <div class="overflow-x-auto">
                            {% if transactions %}
                            <table class="min-w-full divide-y theme-border">
                                <thead
                                    class="sticky top-0"
                                    style="
                                        background-color: var(--bg-hero-color);
                                    "
                                >
                                    <!-- Make header sticky -->
                                    <tr>
                                        <th
                                            scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium theme-text-secondary uppercase tracking-wider"
                                        >
                                            Date
                                        </th>
                                        <th
                                            scope="col"
                                            class="px-6 py-3 text-left text-xs font-medium theme-text-secondary uppercase tracking-wider"
                                        >
                                            Description
                                        </th>
                                        <th
                                            scope="col"
                                            class="px-6 py-3 text-right text-xs font-medium theme-text-secondary uppercase tracking-wider"
                                        >
                                            Amount
                                        </th>
                                    </tr>
                                </thead>
                                <tbody
                                    class="divide-y theme-border"
                                    style="background-color: var(--bg-surface)"
                                >
                                    {% for tx in transactions %}
                                    <tr>
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-sm theme-text-secondary"
                                        >
                                            {{ tx.created.strftime('%b %d, %Y')
                                            }}
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-sm"
                                            style="color: var(--text-color)"
                                        >
                                            {{ tx.description }}
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-right text-sm font-mono {% if tx.amount > 0 %}text-green-600{% else %}text-red-600{% endif %}"
                                        >
                                            {{ "{:+.0f}".format(tx.amount) }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p class="p-6 text-sm theme-text-secondary">
                                You have no transactions yet.
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="lg:col-span-1 space-y-8">
                <!-- Manage Billing -->
                <div
                    class="p-6 rounded-lg theme-shadow theme-border"
                    style="background: var(--bg-hero-color)"
                >
                    <h3 class="font-medium" style="color: var(--text-color)">
                        Manage Billing
                    </h3>
                    <p class="text-sm theme-text-secondary mt-2">
                        Update your payment methods and view past invoices.
                    </p>
                    <a
                        href="/customer-portal"
                        class="mt-4 block w-full text-center rounded-md px-3.5 py-2.5 text-sm font-semibold theme-text-secondary theme-shadow ring-1 ring-inset theme-border hover:bg-slate-50"
                        style="background: var(--bg-color)"
                    >
                        Open Billing Portal
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
